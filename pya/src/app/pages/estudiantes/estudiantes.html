<div class="page">
  <h2 class="title">Gestionar Estudiantes</h2>

  <div class="grid" *ngIf="rol !== 'ADMIN'">
    <section class="card">
      <h3>Verificar elegibilidad</h3>
      <div class="row">
        <input [(ngModel)]="cedulaElegibilidad" placeholder="Cédula" />
        <button (click)="verificarElegibilidad()">Verificar</button>
      </div>
      <p class="muted" *ngIf="resultadoElegibilidad">{{ resultadoElegibilidad }}</p>
    </section>

    <section class="card">
      <h3>Crear estudiante</h3>
      <div class="form">
        <label>Cédula</label>
        <input [(ngModel)]="nuevoEstudiante.cedula" placeholder="1101..." />
        <label>Nombre completo</label>
        <input [(ngModel)]="nuevoEstudiante.nombreCompleto" placeholder="Nombre Apellido" />
        <label>Período académico</label>
        <input [(ngModel)]="nuevoEstudiante.periodoAcademico" placeholder="2025-2026" />
        <label>Estado académico</label>
        <select [(ngModel)]="nuevoEstudiante.estadoAcademico">
          <option value="activo">Activo</option>
          <option value="inactivo">Inactivo</option>
          <option value="graduado">Graduado</option>
          <option value="retirado">Retirado</option>
        </select>
        <label>Estado de cobertura</label>
        <select [(ngModel)]="nuevoEstudiante.estadoCobertura">
          <option value="vigente">Vigente</option>
          <option value="suspendida">Suspendida</option>
          <option value="vencida">Vencida</option>
        </select>
        <label>UID usuario (opcional)</label>
        <input [(ngModel)]="nuevoEstudiante.uidUsuario" placeholder="uid Firebase" />
        <button [disabled]="guardando" (click)="crear()">Crear</button>
      </div>
    </section>
  </div>

  <section class="card">
    <h3>Listado</h3>
    <div *ngIf="cargandoLista" class="muted">Cargando...</div>
    <table *ngIf="!cargandoLista">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Cédula</th>
          <th>Período</th>
          <th>Estado</th>
          <th>Cobertura</th>
          <th *ngIf="rol !== 'ADMIN'">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let est of estudiantes">
          <td>{{ est.nombreCompleto }}</td>
          <td>{{ est.cedula }}</td>
          <td>{{ est.periodoAcademico }}</td>
          <td>
            <span *ngIf="rol === 'ADMIN'">{{ est.estadoAcademico }}</span>
            <select *ngIf="rol !== 'ADMIN'" [(ngModel)]="estadoNuevo[est.idEstudiante || est.id]">
              <option [ngValue]="undefined">-- cambiar --</option>
              <option value="activo">Activo</option>
              <option value="inactivo">Inactivo</option>
              <option value="graduado">Graduado</option>
              <option value="retirado">Retirado</option>
            </select>
          </td>
          <td>{{ est.estadoCobertura }}</td>
          <td *ngIf="rol !== 'ADMIN'">
            <button (click)="actualizarEstado(est)" [disabled]="actualizandoId === (est.idEstudiante || est.id)">Actualizar</button>
            <button (click)="eliminar(est)" [disabled]="borrandoId === (est.idEstudiante || est.id)" style="color: red; margin-left: 8px;">Eliminar</button>
          </td>
        </tr>
      </tbody>
    </table>
  </section>
</div>
