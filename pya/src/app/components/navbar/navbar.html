<aside 
  [class.w-72]="isOpen" 
  [class.w-20]="!isOpen"
  [class]="roleStyles?.bgColor || 'bg-slate-900'"
  class="fixed top-0 left-0 h-full text-white z-40 shadow-xl transition-all duration-300 ease-in-out border-r flex flex-col"
  [ngClass]="roleStyles?.borderColor || 'border-slate-700'">
  
  <!-- Header con color dinÃ¡mico segÃºn rol -->
  <div 
    class="h-16 flex items-center px-4 overflow-hidden shrink-0 transition-all duration-300"
    [style.backgroundColor]="getRoleColor()"
    [style.opacity]="0.9">
    
    <button 
      (click)="toggleMenu()" 
      class="min-w-[40px] h-10 flex items-center justify-center hover:bg-white/20 rounded-lg transition-all active:scale-90">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
    
    <span *ngIf="isOpen" class="ml-4 font-black italic tracking-tighter text-lg whitespace-nowrap drop-shadow-lg">
      PYA <span class="opacity-80">SEGUROS</span>
    </span>

    <!-- Badge de notificaciones (oculto para ADMIN) -->
    <button 
      *ngIf="isOpen && notificacionesNoLeidas > 0 && userRole !== 'ADMIN'"
      (click)="toggleNotificaciones()"
      class="ml-auto relative p-2 hover:bg-white/20 rounded-lg transition-all">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
      </svg>
      <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold">
        {{ notificacionesNoLeidas }}
      </span>
    </button>
  </div>

  <!-- Contenido principal -->
  <div class="flex-grow flex flex-col p-4 overflow-y-auto">
    
    <!-- InformaciÃ³n del usuario -->
    <div 
      class="mb-6 p-4 rounded-2xl border transition-all duration-300"
      [ngClass]="[roleStyles?.badgeColor, roleStyles?.borderColor]">
      
      <div class="flex items-center mb-3">
        <div 
          class="min-w-[48px] h-12 flex items-center justify-center rounded-lg font-bold shadow-lg text-2xl"
          [style.backgroundColor]="getRoleColor()">
          {{ getRoleIcon() }}
        </div>
        
        <div *ngIf="isOpen" class="ml-3 flex-grow">
          <p class="text-xs font-black opacity-70 uppercase tracking-widest leading-none mb-1">
            {{ roleConfig?.nivel }}
          </p>
          <p class="font-bold text-sm">{{ roleConfig?.nombre }}</p>
          <p class="text-xs opacity-75 mt-1">{{ userName }}</p>
        </div>
      </div>
      
      <div *ngIf="isOpen" class="text-xs leading-relaxed opacity-80">
        {{ roleConfig?.descripcion }}
      </div>
    </div>

    <!-- NavegaciÃ³n por rol -->
    <nav class="flex-grow space-y-2">
      
      <!-- CLIENTE: Acceso bÃ¡sico -->
      <div *ngIf="userRole === 'CLIENTE'" class="space-y-2">
        <a 
          *ngIf="canAccess('dashboard')"
          routerLink="/cliente-inicio" 
          routerLinkActive="opacity-100 scale-105" 
          class="flex items-center p-3 rounded-xl hover:bg-white/10 transition-all opacity-75 cursor-pointer group">
          <span class="text-2xl min-w-[32px]">ğŸ“Š</span>
          <span *ngIf="isOpen" class="ml-3 font-bold text-sm">Inicio</span>
        </a>

        <a 
          routerLink="/mi-solicitud" 
          routerLinkActive="opacity-100 scale-105" 
          class="flex items-center p-3 rounded-xl hover:bg-white/10 transition-all opacity-75 cursor-pointer group">
          <span class="text-2xl min-w-[32px]">ğŸ“‹</span>
          <span *ngIf="isOpen" class="ml-3 font-bold text-sm">Mi Solicitud</span>
        </a>

        <a 
          routerLink="/envio-documentos" 
          routerLinkActive="opacity-100 scale-105" 
          class="flex items-center p-3 rounded-xl hover:bg-white/10 transition-all opacity-75 cursor-pointer group">
          <span class="text-2xl min-w-[32px]">ğŸ“</span>
          <span *ngIf="isOpen" class="ml-3 font-bold text-sm">EnvÃ­o de Documentos</span>
        </a>

        <a 
          routerLink="/siniestros" 
          routerLinkActive="opacity-100 scale-105" 
          class="flex items-center p-3 rounded-xl hover:bg-white/10 transition-all opacity-75 cursor-pointer group">
          <span class="text-2xl min-w-[32px]">âš ï¸</span>
          <span *ngIf="isOpen" class="ml-3 font-bold text-sm">Siniestros</span>
        </a>

        <a 
          routerLink="/notificaciones" 
          routerLinkActive="opacity-100 scale-105" 
          class="flex items-center p-3 rounded-xl hover:bg-white/10 transition-all opacity-75 cursor-pointer group relative">
          <span class="text-2xl min-w-[32px]">ğŸ””</span>
          <span *ngIf="isOpen" class="ml-3 font-bold text-sm">Notificaciones</span>
          <span *ngIf="notificacionesNoLeidas > 0" class="absolute top-2 left-6 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold">{{notificacionesNoLeidas}}</span>
        </a>
      </div>

      <!-- GESTOR: GestiÃ³n administrativa -->
      <div *ngIf="userRole === 'GESTOR'" class="space-y-2">
        <a 
          *ngIf="canAccess('dashboard')"
          routerLink="/gestor-dashboard" 
          routerLinkActive="opacity-100 scale-105" 
          class="flex items-center p-3 rounded-xl hover:bg-white/10 transition-all opacity-75 cursor-pointer group">
          <span class="text-2xl min-w-[32px]">ğŸ“Š</span>
          <span *ngIf="isOpen" class="ml-3 font-bold text-sm">Control</span>
        </a>

        <a 
          *ngIf="canAccess('estudiantes')"
          routerLink="/estudiantes" 
          routerLinkActive="opacity-100 scale-105" 
          class="flex items-center p-3 rounded-xl hover:bg-white/10 transition-all opacity-75 cursor-pointer group">
          <span class="text-2xl min-w-[32px]">ğŸ‘¨â€ğŸ“</span>
          <span *ngIf="isOpen" class="ml-3 font-bold text-sm">Estudiantes</span>
        </a>

        <a 
          *ngIf="canAccess('documentos')"
          routerLink="/documentos" 
          routerLinkActive="opacity-100 scale-105" 
          class="flex items-center p-3 rounded-xl hover:bg-white/10 transition-all opacity-75 cursor-pointer group">
          <span class="text-2xl min-w-[32px]">ğŸ“</span>
          <span *ngIf="isOpen" class="ml-3 font-bold text-sm">Documentos</span>
        </a>

        <a 
          *ngIf="canAccess('auditoria')"
          routerLink="/auditoria" 
          routerLinkActive="opacity-100 scale-105" 
          class="flex items-center p-3 rounded-xl hover:bg-white/10 transition-all opacity-75 cursor-pointer group">
          <span class="text-2xl min-w-[32px]">ğŸ“ˆ</span>
          <span *ngIf="isOpen" class="ml-3 font-bold text-sm">Reportes</span>
        </a>

        <a 
          routerLink="/notificaciones" 
          routerLinkActive="opacity-100 scale-105" 
          class="flex items-center p-3 rounded-xl hover:bg-white/10 transition-all opacity-75 cursor-pointer group relative">
          <span class="text-2xl min-w-[32px]">ğŸ””</span>
          <span *ngIf="isOpen" class="ml-3 font-bold text-sm">Notificaciones</span>
          <span *ngIf="notificacionesNoLeidas > 0" class="absolute top-2 left-6 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold">{{notificacionesNoLeidas}}</span>
        </a>
      </div>

      <!-- ADMIN: Control total (sin notificaciones) -->
      <div *ngIf="userRole === 'ADMIN'" class="space-y-2">
        <a 
          *ngIf="canAccess('dashboard')"
          routerLink="/admin-dashboard" 
          routerLinkActive="opacity-100 scale-105" 
          class="flex items-center p-3 rounded-xl hover:bg-white/10 transition-all opacity-75 cursor-pointer group">
          <span class="text-2xl min-w-[32px]">ğŸ›ï¸</span>
          <span *ngIf="isOpen" class="ml-3 font-bold text-sm">Control Total</span>
        </a>

        <a 
          *ngIf="canAccess('usuarios')"
          routerLink="/usuarios" 
          routerLinkActive="opacity-100 scale-105" 
          class="flex items-center p-3 rounded-xl hover:bg-white/10 transition-all opacity-75 cursor-pointer group">
          <span class="text-2xl min-w-[32px]">ğŸ‘¥</span>
          <span *ngIf="isOpen" class="ml-3 font-bold text-sm">Usuarios</span>
        </a>

        <a 
          *ngIf="canAccess('estudiantes')"
          routerLink="/estudiantes" 
          routerLinkActive="opacity-100 scale-105" 
          class="flex items-center p-3 rounded-xl hover:bg-white/10 transition-all opacity-75 cursor-pointer group">
          <span class="text-2xl min-w-[32px]">ğŸ‘¨â€ğŸ“</span>
          <span *ngIf="isOpen" class="ml-3 font-bold text-sm">Estudiantes</span>
        </a>

        <a 
          *ngIf="canAccess('aseguradoras')"
          routerLink="/aseguradoras" 
          routerLinkActive="opacity-100 scale-105" 
          class="flex items-center p-3 rounded-xl hover:bg-white/10 transition-all opacity-75 cursor-pointer group">
          <span class="text-2xl min-w-[32px]">ğŸ¢</span>
          <span *ngIf="isOpen" class="ml-3 font-bold text-sm">Aseguradoras</span>
        </a>

        <a 
          *ngIf="canAccess('auditoria')"
          routerLink="/auditoria" 
          routerLinkActive="opacity-100 scale-105" 
          class="flex items-center p-3 rounded-xl hover:bg-white/10 transition-all opacity-75 cursor-pointer group">
          <span class="text-2xl min-w-[32px]">ğŸ”</span>
          <span *ngIf="isOpen" class="ml-3 font-bold text-sm">AuditorÃ­a</span>
        </a>

        <!-- Notificaciones removidas para ADMIN -->
      </div>

    </nav>

    <!-- Separador -->
    <div class="my-4 h-px bg-white/10"></div>

  </div>

  <!-- Footer con botÃ³n de logout -->
  <div class="p-4 border-t border-white/10">
    <button 
      (click)="logout()" 
      class="w-full flex items-center p-3 rounded-xl transition-all font-bold text-sm gap-3"
      [ngClass]="roleStyles?.buttonColor || 'bg-emerald-600 hover:bg-emerald-700'">
      
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 9V5.25A2.25 2.25 0 0110.5 3h6a2.25 2.25 0 012.25 2.25v13.5A2.25 2.25 0 0116.5 21h-6a2.25 2.25 0 01-2.25-2.25V15m-3 0-3-3m0 0l3-3m-3 3h15" />
      </svg>
      
      <span *ngIf="isOpen" class="uppercase tracking-wider">Cerrar SesiÃ³n</span>
    </button>
  </div>
</aside>

<!-- Panel flotante de notificaciones (no ADMIN) -->
<div *ngIf="userRole !== 'ADMIN' && mostrarNotificaciones" class="fixed inset-0 z-50 flex items-start justify-end pt-20 pr-6">
  <div class="bg-white rounded-2xl shadow-2xl w-96 max-h-[600px] overflow-hidden border border-slate-200">
    <div class="bg-slate-900 text-white p-4 flex justify-between items-center">
      <h3 class="font-black text-lg">ğŸ”” Notificaciones</h3>
      <button (click)="toggleNotificaciones()" class="px-3 py-1 text-xs rounded-lg bg-white/20 hover:bg-white/30">Cerrar</button>
    </div>
    <div class="overflow-y-auto max-h-[500px]">
      <div *ngIf="notificaciones.length === 0" class="p-8 text-center text-slate-400">
        No tienes notificaciones nuevas
      </div>
      <div *ngFor="let notif of notificaciones" class="p-4 border-b border-slate-100 hover:bg-slate-50 transition-all">
        <div class="flex justify-between items-start">
          <div class="flex-grow">
            <p class="text-sm font-bold text-slate-800">{{ notif.mensaje }}</p>
            <p class="text-xs text-slate-400 mt-1">{{ notif.fechaEnvio | date:'short' }}</p>
          </div>
          <button 
            (click)="marcarLeida(notif)"
            class="ml-2 px-2 py-1 text-xs rounded-lg bg-emerald-100 text-emerald-700 hover:bg-emerald-200">
            Marcar leÃ­da
          </button>
        </div>
      </div>
    </div>
  </div>
</div>